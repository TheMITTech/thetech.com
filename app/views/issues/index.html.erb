<h1>Issues</h1>

<table class="table">
  <thead>
    <tr>
      <th>Volume</th>
      <th>Number</th>
      <th>PDF</th>
      <th>Details</th>
    </tr>
  </thead>

  <tbody>
    <% if can? :create, Issue %>
      <tr>
        <%= form_for @new_issue do |f| %>
        <td><%= f.text_field :volume, class: 'form-control', placeholder: 'Volume number' %></td>
        <td><%= f.text_field :number, class: 'form-control', placeholder: 'Issue number' %></td>
        <td colspan="2"><%= f.submit 'Create Issue', id: 'create_issue', class: 'btn btn-primary' %></td>
        <% end %>
      </tr>
    <% end %>

    <% can_upload_pdf = (can? :upload_pdf, @issues.first) %>
    <% can_remove_pdf = (can? :remove_pdf, @issues.first) %>

    <%= content_tag_for(:tr, @issues) do |issue| %>
      <td><%= issue.volume %></td>
      <td><%= issue.number %></td>
      <td id="issue_<%= issue.id %>_upload_pdf">
        <% if issue.pdf.present? %>
          <%= link_to 'View PDF', issue.pdf.url %>
          <% if can_remove_pdf %>
            <%= link_to 'Remove PDF', remove_pdf_issue_path(issue), data: {confirm: 'Do you really want to remove the uploaded PDF? '}, method: :delete %>
          <% end %>
        <% else %>
          <% if can_upload_pdf %>
            <%= link_to 'Upload', upload_pdf_form_issue_path(issue), remote: true %>
          <% end %>
        <% end %>
      </td>
      <td><%= link_to 'Details', issue_path(issue) %></td>
    <% end %>
  </tbody>
</table>
