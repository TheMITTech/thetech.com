(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;this.Image=function(n){function r(e){this.handleAddArticle=t(this.handleAddArticle,this),r.__super__.constructor.call(this,e),this.state={},this.styles={statusCol:{width:"120px",textAlign:"center",padding:"8px 0"},mainCol:{padding:"8px 3px"},actionsCol:{width:"120px",textAlign:"center",paddingBottom:"2px"},thumbnailCol:{width:"150px"},caption:{width:"100%",color:"#000",backgroundColor:"rgba(0, 0, 0, 0)",margin:0},attribution:{width:"100%",color:"#888",margin:0,marginTop:"-5px",backgroundColor:"rgba(0, 0, 0, 0)"},articlesContainer:{margin:"7px 5px 4px 50px",padding:"10px 15px",backgroundColor:"#eee"},removeArticleButton:{marginLeft:"6px"},addArticleSelect:{width:"100%",color:"#888"},articleP:{marginLeft:"0px"}}}return e(r,n),r.propTypes={image:React.PropTypes.object,authors:React.PropTypes.array,articles:React.PropTypes.array},r.prototype.handlePublish=function(t){return this.props.onAction("post",Routes.publish_image_path(this.props.image),{},t)},r.prototype.handleUnpublish=function(t){return this.props.onAction("post",Routes.unpublish_image_path(this.props.image),{},t)},r.prototype.handleUpdate=function(t,e){return this.props.onAction("patch",Routes.image_path(this.props.image),t,e)},r.prototype.handleAttributionUpdate=function(t,e){return null!=t.attribution?this.handleUpdate({author_id:null,attribution:t.attribution},e):logError("Unexpected fields in params. ")},r.prototype.handleAuthorUpdate=function(t,e){return null!=t.attribution?this.handleUpdate({author_id:t.attribution.id,attribution:""},e):logError("Unexpected fields in params. ")},r.prototype.handleRemoveArticle=function(t){return this.props.onAction("patch",Routes.remove_article_image_path(this.props.image),{article_id:t.id})},r.prototype.handleDelete=function(t){return this.props.onAction("delete",Routes.image_path(this.props.image),{},t)},r.prototype.handleAddArticle=function(t,e){return this.props.onAction("patch",Routes.add_article_image_path(this.props.image),{article_id:t},e)},r.prototype.renderButton=function(t,e,n,r,i){return null==r&&(r=!0),null==i&&(i=null),r?React.createElement(Button,{type:t,text:e,onClick:n,confirm:i}):null},r.prototype.renderLink=function(t,e,n,r,i){var o;return null==r&&(r=!0),null==i&&(i=null),r?(o=function(t){return window.open(n),t()},React.createElement(Button,{type:t,text:e,onClick:o,confirm:i})):null},r.prototype.renderWebStatus=function(){switch(this.props.image.web_status){case"web_published":return React.createElement(StatusLabel,{type:"success"},"Web: Published");case"web_ready":return React.createElement(StatusLabel,{type:"info"},"Web: Ready");case"web_draft":return React.createElement(StatusLabel,{type:"danger"},"Web: Draft");default:return logError("Unexpected web_status for image: "+this.props.image.web_status)}},r.prototype.renderPrintStatus=function(){switch(this.props.image.print_status){case"print_ready":return React.createElement(StatusLabel,{type:"success"},"Print: Published");case"print_draft":return React.createElement(StatusLabel,{type:"danger"},"Print: Draft");default:return logError("Unexpected print_status for image: "+this.props.image.print_status)}},r.prototype.renderActions=function(){return React.createElement("td",{style:this.styles.actionsCol},this.renderButton("success","Web Ready",this.handleUpdate.bind(this,{web_status:"web_ready"}),"web_draft"==this.props.image.web_status&&this.props.image.can_ready),this.renderButton("success","Publish",this.handlePublish.bind(this),"web_ready"==this.props.image.web_status&&this.props.image.can_publish),this.renderButton("danger","Unpublish",this.handleUnpublish.bind(this),"web_published"==this.props.image.web_status&&this.props.image.can_unpublish),this.renderButton("success","Print Ready",this.handleUpdate.bind(this,{print_status:"print_ready"}),"print_draft"==this.props.image.print_status&&this.props.image.can_ready),this.renderButton("danger","Delete",this.handleDelete.bind(this),"web_published"!=this.props.image.web_status&&this.props.image.can_destroy,"Are you sure that you want to delete this image? "),this.renderLink("default","Edit",Routes.edit_image_path(this.props.image,{format:"html"})),this.renderLink("default","Show",Routes.image_path(this.props.image,{format:"html"})))},r.prototype.renderArticles=function(){return React.createElement("div",{style:this.styles.articlesContainer},React.createElement("p",null,"Appearing with the following ",pluralize(this.props.image.articles.length,"article"),": "),this.props.image.articles.map(function(t){var e=Routes.article_draft_path(t.id,t.newest_draft.id,{format:"html"});return React.createElement("p",{style:this.styles.articleP,key:t.id},React.createElement("a",{target:"_blank",href:e},t.newest_draft.headline),this.props.image.can_add_article&&React.createElement(LinkButton,{style:this.styles.removeArticleButton,onClick:this.handleRemoveArticle.bind(this,t)},React.createElement("span",{className:"fa fa-trash"})))},this),this.props.image.can_add_article&&React.createElement(AutoSelect,{style:this.styles.addArticleSelect,titles:_.pluck(_.pluck(this.props.articles,"newest_draft"),"headline"),ids:_.pluck(this.props.articles,"id"),prompt:"Select to add an article",onChange:this.handleAddArticle}))},r.prototype.render=function(){return React.createElement("tr",null,React.createElement("td",{style:this.styles.statusCol},this.renderWebStatus(),this.renderPrintStatus()),React.createElement("td",{style:this.styles.mainCol},React.createElement(EditableText,{multiline:!0,readonly:!this.props.image.can_update,style:this.styles.caption,text:this.props.image.caption,paramName:"caption",onCommit:this.handleUpdate.bind(this),placeholder:"Add caption to this image"}),React.createElement(EditableText,{readonly:!this.props.image.can_update,style:this.styles.attribution,text:this.props.image.attribution_text.toUpperCase(),paramName:"attribution",onCommit:this.handleAttributionUpdate.bind(this),onAutocompleteCommit:this.handleAuthorUpdate.bind(this),placeholder:"Add attribution to this image",autoCompleteDictionary:this.props.authors}),this.renderArticles()),this.renderActions(),React.createElement("td",{style:this.styles.thumbnailCol},React.createElement("img",{className:"image-thumbnail",src:this.props.image.web_photo_thumbnail_url})))},r}(React.Component)}).call(this);